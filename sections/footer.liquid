{% comment %}
  Lean Conversion Footer
  Features: Mobile Accordion Menus, Newsletter, Auto-Payment Icons, Auto-Year
{% endcomment %}

<footer class="footer-section">
  <div class="page-width">
    
    <div class="footer-grid">
      {%- for block in section.blocks -%}
        <div class="footer-block block-{{ block.type }}">
          
          {%- case block.type -%}
            
            {%- when 'menu' -%}
              {%- if block.settings.menu != blank -%}
                <div class="footer-menu-wrapper">
                  {% comment %} Mobile: Accordion {% endcomment %}
                  <details class="footer-details small-hide">
                    <summary class="footer-heading-mobile">
                      {{ block.settings.heading | default: block.settings.menu.title }}
                      <span class="icon-plus">+</span>
                    </summary>
                    <ul class="footer-links">
                      {%- for link in block.settings.menu.links -%}
                        <li><a href="{{ link.url }}">{{ link.title }}</a></li>
                      {%- endfor -%}
                    </ul>
                  </details>

                  {% comment %} Desktop: Static {% endcomment %}
                  <div class="medium-up-show">
                    <h3 class="footer-heading">{{ block.settings.heading | default: block.settings.menu.title }}</h3>
                    <ul class="footer-links">
                      {%- for link in block.settings.menu.links -%}
                        <li><a href="{{ link.url }}">{{ link.title }}</a></li>
                      {%- endfor -%}
                    </ul>
                  </div>
                </div>
              {%- endif -%}

            {%- when 'text' -%}
              <div class="footer-text-wrapper">
                <h3 class="footer-heading">{{ block.settings.heading }}</h3>
                <div class="footer-rte">{{ block.settings.text }}</div>
                
                {% comment %} Social Media Placeholder (Logik käme aus settings_schema) {% endcomment %}
                {%- if section.settings.show_social -%}
                  <div class="social-icons">
                    </div>
                {%- endif -%}
              </div>

            {%- when 'newsletter' -%}
              <div class="footer-newsletter-wrapper">
                <h3 class="footer-heading">{{ block.settings.heading }}</h3>
                <p>{{ block.settings.text }}</p>
                
                {%- form 'customer', id: 'FooterNewsletter' -%}
                  <input type="hidden" name="contact[tags]" value="newsletter">
                  <div class="newsletter-form-group">
                    <label for="NewsletterForm--{{ section.id }}" class="visually-hidden">{{ 'footer.email_placeholder' | t }}</label>
                    <input
                      id="NewsletterForm--{{ section.id }}"
                      type="email"
                      name="contact[email]"
                      class="newsletter-input"
                      value="{{ form.email }}"
                      aria-required="true"
                      autocorrect="off"
                      autocapitalize="off"
                      autocomplete="email"
                      placeholder="{{ 'footer.email_placeholder' | t }}"
                      required
                    >
                    <button type="submit" class="newsletter-btn" name="commit">{{ 'footer.subscribe' | t }}</button>
                  </div>
                  {%- if form.errors -%}
                    <small class="newsletter-error">{{ form.errors.translated_fields['email'] | capitalize }} {{ form.errors.messages['email'] }}</small>
                  {%- endif -%}
                  {%- if form.posted_successfully? -%}
                    <small class="newsletter-success">{{ 'footer.subscribe_success' | t }}</small>
                  {%- endif -%}
                {%- endform -%}
              </div>

          {%- endcase -%}
        </div>
      {%- endfor -%}
    </div>

    <div class="footer-bottom">
      <div class="footer-bottom__left">
        <div class="copyright">
          &copy; {{ 'now' | date: "%Y" }} {{ shop.name }}. {{ 'footer.all_rights_reserved' | t }}
        </div>
        {%- render 'sitemap-meta' -%}
      </div>

      {%- if settings.currency_show_footer -%}
        <div class="footer-currency">
          {% render 'currency-switcher', context: 'footer', id_prefix: 'footer' %}
        </div>
      {%- endif -%}

      {%- if section.settings.show_payment -%}
        <div class="payment-icons">
          {%- for type in shop.enabled_payment_types -%}
            {{ type | payment_type_svg_tag: class: 'icon-payment' }}
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>

  </div>
</footer>

<style>
  .footer-section {
    background-color: {{ section.settings.bg_color }};
    color: {{ section.settings.text_color }};
    padding-top: 60px;
    padding-bottom: 30px;
    border-top: 1px solid rgba(0,0,0,0.05);
  }

  .page-width { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

  /* Grid Layout */
  .footer-grid {
    display: grid; gap: 40px;
    margin-bottom: 60px;
  }
  
  @media(min-width: 750px) {
    .footer-grid {
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      align-items: start;
    }
  }

  /* Headings & Links */
  .footer-heading { font-size: 1rem; font-weight: 700; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 0.05em; }
  .footer-links { list-style: none; padding: 0; margin: 0; }
  .footer-links li { margin-bottom: 12px; }
  .footer-links a { text-decoration: none; color: inherit; opacity: 0.7; transition: opacity 0.2s; }
  .footer-links a:hover { opacity: 1; }
  .footer-rte { opacity: 0.7; line-height: 1.6; }

  /* Mobile Accordion Logic */
  .small-hide { display: none; }
  .medium-up-show { display: block; }

  @media(max-width: 749px) {
    .small-hide { display: block; }
    .medium-up-show { display: none; }
    
    .footer-heading-mobile {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.1);
      font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
      list-style: none; cursor: pointer;
    }
    .footer-heading-mobile::-webkit-details-marker { display: none; }
    
    details[open] .icon-plus { transform: rotate(45deg); }
    .icon-plus { transition: transform 0.3s; font-size: 1.2rem; }
    
    .footer-links { padding: 15px 0 0 0; }
  }

  /* Newsletter Form */
  .newsletter-form-group { display: flex; gap: 10px; margin-top: 15px; }
  .newsletter-input {
    flex: 1; padding: 12px; border: 1px solid rgba(0,0,0,0.1); border-radius: 4px;
    background: rgba(255,255,255,0.1); color: inherit;
  }
  .newsletter-btn {
    padding: 12px 20px; background: {{ section.settings.text_color }}; color: {{ section.settings.bg_color }};
    border: none; border-radius: 4px; font-weight: bold; cursor: pointer;
  }
  .newsletter-success { color: green; display: block; margin-top: 10px; }

  /* Bottom Bar */
  .footer-bottom {
    display: flex; flex-direction: column; align-items: center; gap: 20px;
    padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 0.85rem; opacity: 0.6;
  }
  .footer-bottom__left {
    display: flex; flex-direction: column; align-items: center; gap: 6px;
  }
  @media(min-width: 750px) {
    .footer-bottom { flex-direction: row; justify-content: space-between; }
    .footer-bottom__left { align-items: flex-start; }
  }

  .payment-icons { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
  .icon-payment { height: 24px; }
</style>

{% schema %}
{
  "name": "Footer",
  "max_blocks": 4,
  "settings": [
    {
      "type": "color",
      "id": "bg_color",
      "label": "Hintergrund",
      "default": "#121212"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Textfarbe",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "show_payment",
      "label": "Zahlungs-Icons anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_social",
      "label": "Social Media Icons anzeigen",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "menu",
      "name": "Menü",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Titel",
          "default": "Quick Links"
        },
        {
          "type": "link_list",
          "id": "menu",
          "label": "Menü auswählen",
          "default": "footer"
        }
      ]
    },
    {
      "type": "text",
      "name": "Text Info",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Titel",
          "default": "Über uns"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Beschreibe hier deine Marke.</p>"
        }
      ]
    },
    {
      "type": "newsletter",
      "name": "Newsletter",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Titel",
          "default": "Newsletter"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Beschreibung",
          "default": "Melde dich an für Updates und Angebote."
        }
      ]
    }
  ]
}
{% endschema %}
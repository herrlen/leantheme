{% comment %}
  Main Blog Section — Blog-Übersicht
  Layouts: Grid, Liste, Featured + Grid (erster Artikel groß)
  Tag-Filterung, Pagination, Lesezeit, Autor
{% endcomment %}

{%- liquid
  assign layout = section.settings.layout | default: 'grid'
  assign per_page = section.settings.per_page | default: 9
  assign columns = section.settings.columns | default: 3
  assign show_date = section.settings.show_date
  assign show_author = section.settings.show_author
  assign show_read_time = section.settings.show_read_time
  assign show_excerpt = section.settings.show_excerpt
  assign show_tags = section.settings.show_tags
  assign show_tag_filter = section.settings.show_tag_filter
  assign image_ratio = section.settings.image_ratio | default: 'landscape'

  comment
    Active tag filter
  endcomment
  assign current_tag = current_tags | first
-%}

<div class="blog-section section-{{ section.id }}-padding" id="BlogSection-{{ section.id }}">
  <div class="page-width">

    {%- render 'breadcrumbs-wrapper' -%}

    {%- comment -%} ===== Header ===== {%- endcomment -%}
    <div class="blog-header">
      <h1 class="blog-header__title">{{ blog.title }}</h1>
      {%- if section.settings.description != blank -%}
        <p class="blog-header__desc">{{ section.settings.description }}</p>
      {%- endif -%}
    </div>

    {%- comment -%} ===== Tag Filter ===== {%- endcomment -%}
    {%- if show_tag_filter and blog.all_tags.size > 0 -%}
      <nav class="blog-tags" aria-label="Blog-Kategorien">
        <ul class="blog-tags__list">
          <li>
            <a
              href="{{ blog.url }}"
              class="blog-tags__link{% if current_tag == blank %} blog-tags__link--active{% endif %}"
            >
              Alle
            </a>
          </li>
          {%- for tag in blog.all_tags -%}
            <li>
              <a
                href="{{ blog.url }}/tagged/{{ tag | handle }}"
                class="blog-tags__link{% if current_tag == tag %} blog-tags__link--active{% endif %}"
              >
                {{ tag }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </nav>
    {%- endif -%}

    {%- comment -%} ===== Articles ===== {%- endcomment -%}
    {%- paginate blog.articles by per_page -%}

      {%- if blog.articles.size > 0 -%}

        {%- comment -%} Featured + Grid layout {%- endcomment -%}
        {%- if layout == 'featured_grid' and paginate.current_page == 1 -%}
          {%- assign first_article = blog.articles[0] -%}
          <div class="blog-featured">
            {%- render 'article-card',
              card_article: first_article,
              index: 1,
              eager_count: 1,
              featured: true,
              show_excerpt: show_excerpt,
              show_date: show_date,
              show_author: show_author,
              show_tags: show_tags,
              show_read_time: show_read_time,
              image_ratio: 'landscape'
            -%}
          </div>

          {%- if blog.articles.size > 1 -%}
            <div class="blog-grid blog-grid--cols-{{ columns }}">
              {%- for article in blog.articles offset: 1 -%}
                {%- render 'article-card',
                  card_article: article,
                  index: forloop.index,
                  eager_count: 3,
                  featured: false,
                  show_excerpt: show_excerpt,
                  show_date: show_date,
                  show_author: show_author,
                  show_tags: show_tags,
                  show_read_time: show_read_time,
                  image_ratio: image_ratio
                -%}
              {%- endfor -%}
            </div>
          {%- endif -%}

        {%- comment -%} List layout {%- endcomment -%}
        {%- elsif layout == 'list' -%}
          <div class="blog-list">
            {%- for article in blog.articles -%}
              {%- render 'article-card',
                card_article: article,
                index: forloop.index,
                eager_count: 3,
                featured: false,
                show_excerpt: show_excerpt,
                show_date: show_date,
                show_author: show_author,
                show_tags: show_tags,
                show_read_time: show_read_time,
                image_ratio: image_ratio
              -%}
            {%- endfor -%}
          </div>

        {%- comment -%} Default grid / featured_grid page 2+ {%- endcomment -%}
        {%- else -%}
          <div class="blog-grid blog-grid--cols-{{ columns }}">
            {%- for article in blog.articles -%}
              {%- render 'article-card',
                card_article: article,
                index: forloop.index,
                eager_count: 3,
                featured: false,
                show_excerpt: show_excerpt,
                show_date: show_date,
                show_author: show_author,
                show_tags: show_tags,
                show_read_time: show_read_time,
                image_ratio: image_ratio
              -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

      {%- else -%}
        <p class="blog-empty">Noch keine Artikel vorhanden.</p>
      {%- endif -%}

      {%- comment -%} ===== Pagination ===== {%- endcomment -%}
      {%- render 'pagination', paginate: paginate -%}

    {%- endpaginate -%}

  </div>
</div>

<style>
  /* ===== Section ===== */
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
  @media (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 1.5 | round }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 1.5 | round }}px;
    }
  }

  /* ===== Header ===== */
  .blog-header {
    text-align: center;
    margin-bottom: 32px;
  }
  .blog-header__title {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 700;
    margin: 0 0 12px;
    line-height: 1.1;
  }
  .blog-header__desc {
    font-size: 1.05rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ===== Tag Filter ===== */
  .blog-tags {
    margin-bottom: 32px;
    overflow: hidden;
  }
  .blog-tags__list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .blog-tags__link {
    display: inline-block;
    padding: 6px 16px;
    border: 1px solid var(--color-border, #ddd);
    border-radius: 100px;
    font-size: 0.82rem;
    text-decoration: none;
    color: var(--color-text, #333);
    transition: all 0.2s;
    white-space: nowrap;
  }
  .blog-tags__link:hover {
    border-color: var(--color-text, #333);
  }
  .blog-tags__link--active {
    background: var(--color-primary, #000);
    color: var(--color-primary-contrast, #fff);
    border-color: var(--color-primary, #000);
  }

  /* ===== Grid Layout ===== */
  .blog-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 32px;
  }
  @media (min-width: 600px) {
    .blog-grid--cols-2 { grid-template-columns: repeat(2, 1fr); }
    .blog-grid--cols-3 { grid-template-columns: repeat(2, 1fr); }
  }
  @media (min-width: 990px) {
    .blog-grid--cols-3 { grid-template-columns: repeat(3, 1fr); }
  }

  /* ===== Featured ===== */
  .blog-featured {
    margin-bottom: 40px;
  }

  /* ===== List Layout ===== */
  .blog-list {
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 900px;
    margin: 0 auto;
  }
  .blog-list .article-card {
    display: block;
  }
  .blog-list .article-card__link {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
  }
  @media (min-width: 600px) {
    .blog-list .article-card__link {
      grid-template-columns: 280px 1fr;
      gap: 28px;
    }
  }
  .blog-list .article-card__media {
    aspect-ratio: 3 / 2;
  }
  .blog-list .article-card__title {
    font-size: 1.3rem;
  }

  /* ===== Article Card Styles ===== */
  .article-card {
    position: relative;
  }

  .article-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .article-card__media {
    position: relative;
    overflow: hidden;
    border-radius: var(--border-radius-card, 8px);
    background: var(--color-background-secondary, #f5f5f5);
    margin-bottom: 14px;
  }
  .article-card__media--landscape { aspect-ratio: 16 / 9; }
  .article-card__media--square { aspect-ratio: 1 / 1; }
  .article-card__media--3\/2 { aspect-ratio: 3 / 2; }

  .article-card__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.4s ease;
  }
  .article-card:hover .article-card__img {
    transform: scale(1.03);
  }

  .article-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    aspect-ratio: 16 / 9;
    background: #f0f0f0;
  }

  .article-card__tags {
    position: absolute;
    top: 10px;
    left: 10px;
    display: flex;
    gap: 6px;
    z-index: 2;
  }
  .article-card__tag {
    display: inline-block;
    padding: 3px 10px;
    background: rgba(0,0,0,0.7);
    color: #fff;
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-radius: 4px;
  }

  .article-card__content {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .article-card__meta {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.78rem;
    color: #888;
  }
  .article-card__meta-sep {
    font-size: 0.6rem;
  }

  .article-card__title {
    font-size: 1.1rem;
    font-weight: 600;
    line-height: 1.3;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .article-card:hover .article-card__title {
    text-decoration: underline;
  }

  .article-card__excerpt {
    font-size: 0.9rem;
    color: #555;
    line-height: 1.6;
    margin: 0;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .article-card__author {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.78rem;
    color: #888;
  }

  .article-card__read-more {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--color-primary, #000);
    margin-top: 4px;
    transition: gap 0.2s;
  }
  .article-card:hover .article-card__read-more {
    gap: 8px;
  }

  /* ===== Featured Card ===== */
  .article-card--featured .article-card__link {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }
  @media (min-width: 750px) {
    .article-card--featured .article-card__link {
      grid-template-columns: 1.3fr 1fr;
      gap: 36px;
      align-items: center;
    }
  }
  .article-card--featured .article-card__media {
    aspect-ratio: 16 / 9;
    margin-bottom: 0;
  }
  .article-card--featured .article-card__title {
    font-size: clamp(1.4rem, 3vw, 1.8rem);
    -webkit-line-clamp: 3;
  }
  .article-card--featured .article-card__excerpt {
    -webkit-line-clamp: 4;
    font-size: 0.95rem;
  }

  .blog-empty {
    text-align: center;
    color: #999;
    font-size: 1rem;
    padding: 60px 20px;
  }
</style>

{% schema %}
{
  "name": "Blog Übersicht",
  "tag": "section",
  "class": "blog-section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "featured_grid", "label": "Featured + Grid (erster Artikel groß)" },
        { "value": "list", "label": "Liste" }
      ],
      "default": "grid"
    },
    {
      "type": "select",
      "id": "columns",
      "label": "Spalten (Grid)",
      "options": [
        { "value": "2", "label": "2 Spalten" },
        { "value": "3", "label": "3 Spalten" }
      ],
      "default": "3",
      "info": "Nur im Grid-Layout relevant."
    },
    {
      "type": "range",
      "id": "per_page",
      "label": "Artikel pro Seite",
      "min": 3,
      "max": 24,
      "step": 3,
      "default": 9
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Bild-Verhältnis",
      "options": [
        { "value": "landscape", "label": "Landscape (16:9)" },
        { "value": "3/2", "label": "3:2" },
        { "value": "square", "label": "Quadrat (1:1)" }
      ],
      "default": "landscape"
    },
    {
      "type": "header",
      "content": "Inhalt"
    },
    {
      "type": "text",
      "id": "description",
      "label": "Blog-Beschreibung (optional)",
      "info": "Wird unter dem Titel angezeigt."
    },
    {
      "type": "checkbox",
      "id": "show_tag_filter",
      "label": "Tag-Filter anzeigen",
      "default": true,
      "info": "Zeigt Blog-Tags als Filter-Buttons an."
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Datum anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Autor anzeigen",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_read_time",
      "label": "Lesezeit anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Excerpt anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_tags",
      "label": "Tags auf Bild anzeigen",
      "default": true
    },
    {
      "type": "header",
      "content": "Abstand"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px",
      "label": "Abstand Oben"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 40,
      "unit": "px",
      "label": "Abstand Unten"
    }
  ]
}
{% endschema %}

{% comment %}
  Lean Featured Blog
  Features: Grid Layout, Auto-Author, Date, Excerpt toggles.
{% endcomment %}

<div class="section-featured-blog section-{{ section.id }}-padding">
  <div class="page-width">
    
    {%- if section.settings.heading != blank -%}
      <div class="section-header text-{{ section.settings.heading_align }}">
        <h2 class="section-heading">{{ section.settings.heading }}</h2>
        {%- if section.settings.show_view_all and section.settings.blog != blank -%}
          <a href="{{ section.settings.blog.url }}" class="link-view-all">
            {{ section.settings.view_all_label }} &rarr;
          </a>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="blog-grid">
      {%- assign blog = section.settings.blog -%}
      
      {%- if blog != blank and blog.articles_count > 0 -%}
        {%- for article in blog.articles limit: section.settings.post_limit -%}
          <a href="{{ article.url }}" class="blog-card">
            
            <div class="blog-card-image-wrapper">
              {%- if article.image -%}
                <img
                  src="{{ article.image | image_url: width: 600 }}"
                  alt="{{ article.image.alt | escape }}"
                  loading="lazy"
                  width="{{ article.image.width }}"
                  height="{{ article.image.height }}"
                  class="blog-card-image"
                >
              {%- else -%}
                <div class="blog-placeholder-image"></div>
              {%- endif -%}
            </div>

            <div class="blog-card-content">
              
              <div class="blog-meta">
                {%- if section.settings.show_date -%}
                  <span class="blog-date">{{ article.published_at | time_tag: format: 'date' }}</span>
                {%- endif -%}

                {%- if section.settings.show_date and section.settings.show_author -%}
                  <span class="meta-separator">•</span>
                {%- endif -%}

                {%- if section.settings.show_author -%}
                  <span class="blog-author">{{ article.author }}</span>
                {%- endif -%}
              </div>

              <h3 class="blog-title">{{ article.title }}</h3>

              {%- if section.settings.show_excerpt -%}
                <div class="blog-excerpt">
                  {%- if article.excerpt.size > 0 -%}
                    {{ article.excerpt | strip_html | truncatewords: 20 }}
                  {%- else -%}
                    {{ article.content | strip_html | truncatewords: 20 }}
                  {%- endif -%}
                </div>
              {%- endif -%}

              <span class="link-read-more">Weiterlesen</span>
            </div>
          </a>
        {%- endfor -%}

      {%- else -%}
        {%- for i in (1..3) -%}
          <div class="blog-card">
            <div class="blog-card-image-wrapper">
              {{ 'image' | placeholder_svg_tag: 'blog-card-image placeholder' }}
            </div>
            <div class="blog-card-content">
              <div class="blog-meta">
                <span class="blog-date">01. Januar 2026</span>
                <span class="meta-separator">•</span>
                <span class="blog-author">Max Mustermann</span>
              </div>
              <h3 class="blog-title">Beispiel Beitrag</h3>
              <div class="blog-excerpt">Ein spannender Einblick in die Welt deiner Produkte.</div>
              <span class="link-read-more">Weiterlesen</span>
            </div>
          </div>
        {%- endfor -%}
      {%- endif -%}
    </div>

  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
    background-color: {{ section.settings.bg_color }};
  }

  /* Header */
  .section-header {
    margin-bottom: 40px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  @media(min-width: 750px) {
    .section-header {
      flex-direction: row;
      justify-content: space-between;
      align-items: baseline;
    }
    .text-center.section-header { justify-content: center; flex-direction: column; align-items: center; }
  }
  .text-center { text-align: center; }
  .text-left { text-align: left; }
  .section-heading { font-size: 2rem; margin: 0; }
  .link-view-all { text-decoration: none; color: inherit; font-size: 0.9rem; opacity: 0.7; }
  .link-view-all:hover { opacity: 1; }

  /* Grid */
  .blog-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 30px;
  }
  @media(min-width: 750px) {
    .blog-grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* Card */
  .blog-card {
    display: block; text-decoration: none; color: inherit;
  }
  .blog-card-image-wrapper {
    position: relative; width: 100%; aspect-ratio: 16/9;
    overflow: hidden; border-radius: 4px; margin-bottom: 15px;
    background-color: #f0f0f0;
  }
  .blog-card-image {
    width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease;
  }
  .blog-card:hover .blog-card-image { transform: scale(1.05); }

  /* Meta Info (Date & Author) */
  .blog-meta {
    font-size: 0.8rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .meta-separator { font-size: 1.2em; line-height: 0; color: #ccc; }

  .blog-title { margin: 0 0 10px 0; font-size: 1.3rem; line-height: 1.3; }
  .blog-excerpt { font-size: 0.95rem; line-height: 1.6; color: #444; margin-bottom: 15px; }
  .link-read-more { font-size: 0.9rem; font-weight: 600; text-decoration: underline; text-underline-offset: 4px; }
  .blog-placeholder-image { width: 100%; height: 100%; background: #e0e0e0; }
</style>

{% schema %}
{
  "name": "Blog Beiträge",
  "settings": [
    {
      "type": "header",
      "content": "Inhalt"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Überschrift",
      "default": "Aus unserem Magazin"
    },
    {
      "type": "select",
      "id": "heading_align",
      "label": "Ausrichtung",
      "options": [
        { "value": "left", "label": "Links" },
        { "value": "center", "label": "Zentriert" }
      ],
      "default": "left"
    },
    {
      "type": "blog",
      "id": "blog",
      "label": "Blog auswählen"
    },
    {
      "type": "range",
      "id": "post_limit",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 3,
      "label": "Anzahl Beiträge"
    },
    {
      "type": "header",
      "content": "Details anzeigen"
    },
    {
      "type": "checkbox",
      "id": "show_date",
      "label": "Datum anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_author",
      "label": "Autor anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_excerpt",
      "label": "Kurzbeschreibung anzeigen",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "'Alle ansehen' Link zeigen",
      "default": true
    },
    {
      "type": "text",
      "id": "view_all_label",
      "label": "Link Text",
      "default": "Alle Beiträge"
    },
    {
      "type": "header",
      "content": "Design"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Hintergrundfarbe",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Abstand oben",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Abstand unten",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Blog Beiträge"
    }
  ]
}
{% endschema %}
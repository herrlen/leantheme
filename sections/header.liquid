{% comment %}
  Lean Header - Final Version with Mobile Menu
{% endcomment %}

<header 
  id="site-header"
  class="site-header {% if section.settings.enable_transparent_header and request.page_type == 'index' %}is-transparent{% endif %}"
  data-transparent="{{ section.settings.enable_transparent_header }}"
>
  
  <div class="header__left">
    
    <button type="button" class="header__hamburger" id="mobile-menu-trigger" aria-label="Menü öffnen">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>

    <a href="{{ routes.root_url }}" class="header__logo">
      {{ shop.name }}
    </a>
  </div>

  <nav class="header__center">
    <ul class="header__menu-list">
      {%- for link in section.settings.menu.links -%}
        <li>
          <a href="{{ link.url }}" class="header__menu-link">
            {{ link.title }}
          </a>
        </li>
      {%- endfor -%}
    </ul>
  </nav>

  <div class="header__right">
    {%- if shop.customer_accounts_enabled -%}
      <a href="{{ routes.account_url }}" class="header__icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
      </a>
    {%- endif -%}

    <a href="{{ routes.cart_url }}" class="header__icon cart-icon-wrapper">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
      {%- if cart.item_count > 0 -%}
        <span class="cart-count">{{ cart.item_count }}</span>
      {%- endif -%}
    </a>
  </div>
</header>

<div class="mobile-drawer" id="mobile-drawer">
  <div class="drawer-header">
    <span class="drawer-title">Menü</span>
    <button type="button" class="drawer-close" id="mobile-menu-close">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    </button>
  </div>
  
  <ul class="drawer-menu-list">
    {%- for link in section.settings.menu.links -%}
      <li>
        <a href="{{ link.url }}" class="drawer-link">
          {{ link.title }}
        </a>
      </li>
    {%- endfor -%}
  </ul>
</div>

<div class="mobile-overlay" id="mobile-overlay"></div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 1. Sticky Header Logic
    const header = document.getElementById('site-header');
    function handleScroll() {
      if (window.scrollY > 10) header.classList.add('is-scrolled');
      else header.classList.remove('is-scrolled');
    }
    window.addEventListener('scroll', handleScroll);

    // 2. Mobile Menu Logic
    const trigger = document.getElementById('mobile-menu-trigger');
    const closeBtn = document.getElementById('mobile-menu-close');
    const drawer = document.getElementById('mobile-drawer');
    const overlay = document.getElementById('mobile-overlay');

    function toggleMenu() {
      drawer.classList.toggle('is-open');
      overlay.classList.toggle('is-open');
      document.body.classList.toggle('no-scroll'); // Verhindert Scrollen im Hintergrund
    }

    if (trigger) trigger.addEventListener('click', toggleMenu);
    if (closeBtn) closeBtn.addEventListener('click', toggleMenu);
    if (overlay) overlay.addEventListener('click', toggleMenu);
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_transparent_header",
      "default": true,
      "label": "Transparenter Header (Startseite)"
    },
    {
       "type": "link_list",
       "id": "menu",
       "label": "Menü",
       "default": "main-menu"
    }
  ]
}
{% endschema %}
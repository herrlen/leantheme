{% comment %}
  Advanced Header V4 (Button Styling Update)
  Features: Customizable Search Button via Schema
{% endcomment %}

<header class="header-section {% if section.settings.enable_transparent %}header-transparent{% endif %}">
  <div class="page-width">
    
    <div class="header-wrapper layout-{{ section.settings.logo_position }}">
      
      <nav class="header-nav hidden-mobile">
        <ul class="nav-list">
          {%- for link in section.settings.menu.links -%}
            <li>
              <a href="{{ link.url }}" class="nav-link {% if link.active %}nav-link--active{% endif %}">
                {{ link.title }}
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </nav>

      <div class="header-drawer-trigger">
        <details>
          <summary class="icon-button">
            <span class="hamburger-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </span>
          </summary>
          <div class="mobile-drawer-content">
             <ul class="mobile-nav-list">
               {%- for link in section.settings.menu.links -%}
                 <li><a href="{{ link.url }}">{{ link.title }}</a></li>
               {%- endfor -%}
             </ul>
          </div>
        </details>
      </div>

      <div class="header-logo">
        <a href="{{ routes.root_url }}" class="logo-link">
          {%- if section.settings.logo != blank -%}
            <img src="{{ section.settings.logo | image_url: width: section.settings.logo_width }}"
                 alt="{{ shop.name }}"
                 width="{{ section.settings.logo_width }}"
                 height="{{ section.settings.logo_width | divided_by: section.settings.logo.aspect_ratio | ceil }}"
                 loading="eager">
          {%- else -%}
            <span class="logo-text">{{ shop.name }}</span>
          {%- endif -%}
        </a>
      </div>

      <div class="header-icons">
        <predictive-search class="search-component">
          <form action="{{ routes.search_url }}" method="get" role="search" class="search-form">
            <input
              id="Search-In-Modal"
              type="search"
              name="q"
              value=""
              placeholder="Suche"
              role="combobox"
              aria-expanded="false"
              aria-owns="predictive-search-results"
              aria-controls="predictive-search-results"
              aria-haspopup="listbox"
              class="search-input"
            >
            <input name="options[prefix]" type="hidden" value="last">
            <div id="predictive-search" tabindex="-1"></div>
          </form>
        </predictive-search>

        <a href="{{ routes.cart_url }}" class="icon-button cart-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
          <span class="cart-count">({{ cart.item_count }})</span>
        </a>
      </div>

    </div>
  </div>
</header>

<script>
  class PredictiveSearch extends HTMLElement {
    constructor() {
      super();
      this.input = this.querySelector('input[type="search"]');
      this.predictiveSearchResults = this.querySelector('#predictive-search');
      this.input.addEventListener('input', this.debounce((event) => {
        this.onChange(event);
      }, 300).bind(this));
    }
    onChange() {
      const searchTerm = this.input.value.trim();
      if (!searchTerm.length) { this.close(); return; }
      this.getSearchResults(searchTerm);
    }
    getSearchResults(searchTerm) {
      fetch(`/search/suggest?q=${searchTerm}&section_id=predictive-search`)
        .then((response) => {
          if (!response.ok) { var error = new Error(response.statusText); error.code = response.status; throw error; }
          return response.text();
        })
        .then((text) => {
          const resultsMarkup = new DOMParser().parseFromString(text, 'text/html').querySelector('#shopify-section-predictive-search').innerHTML;
          this.predictiveSearchResults.innerHTML = resultsMarkup;
          this.open();
        })
        .catch((error) => { this.close(); throw error; });
    }
    open() { this.predictiveSearchResults.style.display = 'block'; }
    close() { this.predictiveSearchResults.style.display = 'none'; this.predictiveSearchResults.innerHTML = ''; }
    debounce(fn, wait) {
      let t;
      return (...args) => { clearTimeout(t); t = setTimeout(() => fn.apply(this, args), wait); };
    }
  }
  customElements.define('predictive-search', PredictiveSearch);
</script>

<style>
  /* --- BASIS --- */
  .header-section { background: #ffffff; border-bottom: 1px solid #eee; padding: 15px 0; position: relative; z-index: 100; transition: background 0.3s; }
  .page-width { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
  .header-wrapper { display: flex; align-items: center; width: 100%; position: relative; }

  /* TRANSPARENT MODE */
  .header-transparent { position: absolute; top: 0; left: 0; right: 0; background: transparent; border-bottom: none; }
  .header-transparent .nav-link, .header-transparent .logo-text, .header-transparent .icon-button, .header-transparent .cart-icon, .header-transparent .search-input { color: #fff; }
  .header-transparent .search-input { border-color: rgba(255,255,255,0.5); }
  .header-transparent .search-input::placeholder { color: rgba(255,255,255,0.8); }

  /* --- LAYOUTS --- */
  .layout-logo_left_menu_center { justify-content: space-between; }
  .layout-logo_left_menu_center .header-logo { order: 1; margin-right: auto; }
  .layout-logo_left_menu_center .header-nav { order: 2; flex-grow: 1; text-align: center; }
  .layout-logo_left_menu_center .header-icons { order: 3; margin-left: auto; }
  .layout-logo_left_menu_center .header-drawer-trigger { display: none; }

  .layout-logo_left_menu_left { justify-content: flex-start; gap: 40px; }
  .layout-logo_left_menu_left .header-logo { order: 1; }
  .layout-logo_left_menu_left .header-nav { order: 2; }
  .layout-logo_left_menu_left .header-icons { order: 3; margin-left: auto; }
  .layout-logo_left_menu_left .header-drawer-trigger { display: none; }

  .layout-logo_center_menu_left { justify-content: space-between; }
  .layout-logo_center_menu_left .header-nav { display: none; }
  .layout-logo_center_menu_left .header-drawer-trigger { display: block; order: 1; }
  .layout-logo_center_menu_left .header-icons { order: 3; }
  .layout-logo_center_menu_left .header-logo {
    position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%);
    order: 2; z-index: 5; width: max-content; margin: 0;
  }

  /* --- SEARCH RESULTS --- */
  #predictive-search { display: none; position: absolute; top: 100%; right: 0; width: 350px; background: #fff; border: 1px solid #eee; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 4px; z-index: 20; margin-top: 10px; color: #000; }
  .predictive-search-heading { padding: 12px; margin: 0; font-size: 0.75rem; text-transform: uppercase; color: #888; border-bottom: 1px solid #f4f4f4; letter-spacing: 0.05em; }
  .predictive-search-list { list-style: none; margin: 0; padding: 0; }
  .predictive-search-item { border-bottom: 1px solid #f4f4f4; }
  .predictive-search-link { display: flex; gap: 15px; padding: 10px; text-decoration: none; color: #000; align-items: center; }
  .predictive-search-link:hover { background: #f9f9f9; }
  .predictive-search-image { border-radius: 3px; border: 1px solid #eee; object-fit: cover; }
  .predictive-search-info { display: flex; flex-direction: column; }
  .predictive-search-title { font-weight: 600; font-size: 0.9rem; }
  .predictive-search-price { font-size: 0.85rem; color: #666; }
  .predictive-search-empty { padding: 15px; text-align: center; color: #666; font-size: 0.9rem; }
  
  /* --- CUSTOM BUTTON STYLING (Dynamisch) --- */
  .predictive-search-footer { padding: 10px; text-align: center; }
  
  /* Button Basis Style */
  .search-results-btn {
    display: inline-block;
    cursor: pointer;
    text-decoration: none;
    transition: opacity 0.3s;
    border: none;
    width: 100%;
    
    /* Dynamische Werte aus Schema */
    background-color: {{ section.settings.search_btn_bg }};
    color: {{ section.settings.search_btn_text }};
    border-radius: {{ section.settings.search_btn_shape }};
    
    {% if section.settings.search_btn_size == 'small' %}
      padding: 8px 15px; font-size: 0.8rem; font-weight: normal;
    {% else %}
      padding: 12px 20px; font-size: 1rem; font-weight: bold; text-transform: uppercase;
    {% endif %}
  }
  .search-results-btn:hover { opacity: 0.9; }

  /* Logik zum Ausblenden des Buttons */
  {% unless section.settings.show_search_button %}
    .predictive-search-footer { display: none !important; }
  {% endunless %}

  /* --- ELEMENTE REST --- */
  .nav-list { list-style: none; padding: 0; margin: 0; display: inline-flex; gap: 25px; }
  .nav-link { text-decoration: none; color: inherit; font-weight: 500; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.05em; }
  .logo-text { font-size: 1.5rem; font-weight: 800; text-transform: uppercase; color: inherit; white-space: nowrap; }
  .header-logo img { display: block; max-height: 100px; }
  .header-icons { display: flex; gap: 15px; align-items: center; color: inherit; }
  .icon-button { background: none; border: none; cursor: pointer; color: inherit; display: flex; align-items: center; }
  .cart-icon { display: flex; align-items: center; gap: 5px; text-decoration: none; font-weight: 600; }
  .search-component { position: relative; }
  .search-input { background: transparent; border: 1px solid #ddd; padding: 8px 12px; border-radius: 4px; font-size: 0.9rem; width: 140px; transition: width 0.3s; color: inherit; }
  .search-input:focus { width: 220px; outline: none; border-color: #000; background: #fff; color: #000; }

  /* Mobile */
  .header-drawer-trigger { display: none; }
  .mobile-drawer-content { position: absolute; top: 100%; left: 0; width: 100%; background: #fff; border-bottom: 1px solid #eee; padding: 20px; display: none; color: #000; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
  details[open] .mobile-drawer-content { display: block; }
  .mobile-nav-list { list-style: none; padding: 0; }
  .mobile-nav-list li { margin-bottom: 15px; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; }
  .mobile-nav-list a { text-decoration: none; color: #000; font-size: 1.1rem; font-weight: 600; display: block; }

  @media(max-width: 990px) {
    .header-nav { display: none !important; }
    .header-drawer-trigger { display: block !important; order: 1; }
    .header-icons { order: 3; margin-left: auto; }
    .header-wrapper { justify-content: space-between; }
    .header-logo { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); order: 2; width: max-content; margin: 0; }
  }
</style>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "select",
      "id": "logo_position",
      "label": "Desktop Layout",
      "options": [
        { "value": "logo_left_menu_center", "label": "Logo Links / Menü Mitte" },
        { "value": "logo_left_menu_left", "label": "Logo Links / Menü Links" },
        { "value": "logo_center_menu_left", "label": "Logo Mitte / Burger Menü" }
      ],
      "default": "logo_left_menu_center"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent",
      "label": "Transparenter Hintergrund",
      "default": false
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Bild"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50, "max": 300, "step": 10, "default": 120, "unit": "px", "label": "Logo Breite"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menü",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Suche - Ergebnisse Button"
    },
    {
      "type": "checkbox",
      "id": "show_search_button",
      "label": "Button 'Alle anzeigen' zeigen",
      "default": true
    },
    {
      "type": "color",
      "id": "search_btn_bg",
      "label": "Hintergrundfarbe",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "search_btn_text",
      "label": "Textfarbe",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "search_btn_shape",
      "label": "Form",
      "options": [
        { "value": "0px", "label": "Eckig" },
        { "value": "4px", "label": "Leicht abgerundet" },
        { "value": "30px", "label": "Pille (Rund)" }
      ],
      "default": "4px"
    },
    {
      "type": "select",
      "id": "search_btn_size",
      "label": "Größe",
      "options": [
        { "value": "small", "label": "Klein & Dezent" },
        { "value": "large", "label": "Groß & Auffällig" }
      ],
      "default": "small"
    }
  ]
}
{% endschema %}
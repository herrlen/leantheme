{% comment %}
  Lean Feature Products (FIXED)
  Features: Drag & Drop, Hybrid Logic, Custom Alignment, Bold Options.
  Self-contained: No external snippets required.
{% endcomment %}

<div class="section-featured-products section-{{ section.id }}-padding">
  <div class="page-width">
    
    {%- if section.settings.heading != blank -%}
      <div class="collection-heading" style="text-align: {{ section.settings.heading_align }};">
        <h2>{{ section.settings.heading }}</h2>
      </div>
    {%- endif -%}

    <div class="product-grid">
      
      {% comment %} --- LOGIK: ENTWEDER BLÖCKE ODER COLLECTION --- {% endcomment %}
      
      {%- if section.blocks.size > 0 -%}
        {%- for block in section.blocks -%}
          {%- assign product = block.settings.product -%}
          {%- if product != blank -%}
            
            <a href="{{ product.url }}" class="product-card" {{ block.shopify_attributes }}>
              <div class="card-media">
                <img
                  src="{{ product.featured_image | image_url: width: 800 }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  width="{{ product.featured_image.width }}"
                  height="{{ product.featured_image.height }}"
                  loading="lazy"
                  class="card-img"
                >
                {%- if product.compare_at_price > product.price -%}
                  <span class="badge-sale">Sale</span>
                {%- endif -%}
              </div>
              <div class="card-info align-{{ section.settings.info_align }}">
                <h3 class="card-title {% if section.settings.bold_title %}font-bold{% endif %}">
                  {{ product.title }}
                </h3>
                <div class="card-price {% if section.settings.bold_price %}font-bold{% endif %}">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="price-compare">{{ product.compare_at_price | money }}</span>
                  {%- endif -%}
                  <span class="price-final">{{ product.price | money }}</span>
                </div>
              </div>
            </a>

          {%- else -%}
            <div class="product-card" {{ block.shopify_attributes }}>
              <div class="card-media">
                {{ 'product-1' | placeholder_svg_tag: 'card-img placeholder' }}
              </div>
              <div class="card-info align-{{ section.settings.info_align }}">
                <h3 class="card-title">Produkt wählen</h3>
                <span class="card-price">--</span>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}

      {%- elsif section.settings.collection != blank -%}
        {%- assign limit = section.settings.products_to_show -%}
        {%- for product in section.settings.collection.products limit: limit -%}
          
          <a href="{{ product.url }}" class="product-card">
            <div class="card-media">
              <img
                src="{{ product.featured_image | image_url: width: 800 }}"
                alt="{{ product.featured_image.alt | escape }}"
                width="{{ product.featured_image.width }}"
                height="{{ product.featured_image.height }}"
                loading="lazy"
                class="card-img"
              >
              {%- if product.compare_at_price > product.price -%}
                <span class="badge-sale">Sale</span>
              {%- endif -%}
            </div>
            <div class="card-info align-{{ section.settings.info_align }}">
              <h3 class="card-title {% if section.settings.bold_title %}font-bold{% endif %}">
                {{ product.title }}
              </h3>
              <div class="card-price {% if section.settings.bold_price %}font-bold{% endif %}">
                {%- if product.compare_at_price > product.price -%}
                  <span class="price-compare">{{ product.compare_at_price | money }}</span>
                {%- endif -%}
                <span class="price-final">{{ product.price | money }}</span>
              </div>
            </div>
          </a>

        {%- endfor -%}

      {%- else -%}
        {%- for i in (1..4) -%}
          <div class="product-card">
            <div class="card-media">
              {{ 'product-' | append: i | placeholder_svg_tag: 'card-img placeholder' }}
            </div>
            <div class="card-info align-{{ section.settings.info_align }}">
              <h3 class="card-title">Beispiel Produkt</h3>
              <span class="card-price">€99,00</span>
            </div>
          </div>
        {%- endfor -%}
      {%- endif -%}

    </div>
  </div>
</div>

<style>
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }

  .collection-heading { margin-bottom: 40px; }
  .collection-heading h2 { font-size: 2rem; margin: 0; font-weight: 500; }

  /* GRID */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px 15px;
  }

  @media (min-width: 750px) {
    .product-grid {
      grid-template-columns: repeat({{ section.settings.columns_desktop }}, 1fr);
      gap: 40px 30px;
    }
  }

  /* CARD */
  .product-card { text-decoration: none; color: inherit; display: block; position: relative; }
  
  .card-media {
    position: relative;
    overflow: hidden;
    margin-bottom: 12px;
    background: #f4f4f4;
    border-radius: 4px;
  }

  .card-img {
    width: 100%; height: auto; aspect-ratio: 1/1; object-fit: cover;
    transition: transform 0.6s ease; display: block;
  }
  .product-card:hover .card-img { transform: scale(1.03); }

  .badge-sale {
    position: absolute; top: 10px; left: 10px;
    background: #000; color: #fff; font-size: 0.7rem;
    padding: 3px 6px; text-transform: uppercase; font-weight: 700;
  }

  /* ALIGNMENT LOGIC */
  .card-info { display: flex; font-size: 1rem; line-height: 1.4; gap: 5px; }

  /* 1. Split (Links Name, Rechts Preis) */
  .align-split { justify-content: space-between; text-align: left; flex-direction: row; }
  .align-split .card-price { text-align: right; white-space: nowrap; }

  /* 2. Stacked Left */
  .align-left { flex-direction: column; text-align: left; align-items: flex-start; }

  /* 3. Stacked Center */
  .align-center { flex-direction: column; text-align: center; align-items: center; }

  /* 4. Stacked Right */
  .align-right { flex-direction: column; text-align: right; align-items: flex-end; }

  /* TYPOGRAPHY */
  .card-title { margin: 0; font-size: 1rem; font-weight: 400; }
  .card-price { font-weight: 400; color: #111; }

  .font-bold { font-weight: 700 !important; }

  .price-compare {
    text-decoration: line-through; color: #888;
    font-size: 0.9em; margin-right: 5px; font-weight: 400;
  }
</style>

{% schema %}
{
  "name": "Feature Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Überschrift",
      "default": "Ausgewählte Produkte"
    },
    {
      "type": "select",
      "id": "heading_align",
      "label": "Überschrift Ausrichtung",
      "options": [
        { "value": "left", "label": "Links" },
        { "value": "center", "label": "Zentriert" }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Inhalt"
    },
    {
      "type": "paragraph",
      "content": "Nutze 'Einzelne Produkte' (Blöcke) für Drag & Drop. Wenn keine Blöcke da sind, wird die Kategorie verwendet:"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Standard Kategorie"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Anzahl (nur für Kategorie)"
    },
    {
      "type": "header",
      "content": "Design & Text"
    },
    {
      "type": "select",
      "id": "info_align",
      "label": "Text & Preis Ausrichtung",
      "options": [
        { "value": "split", "label": "Split (Links/Rechts)" },
        { "value": "left", "label": "Links (untereinander)" },
        { "value": "center", "label": "Zentriert (untereinander)" },
        { "value": "right", "label": "Rechts (untereinander)" }
      ],
      "default": "split"
    },
    {
      "type": "checkbox",
      "id": "bold_title",
      "label": "Produktname fett",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "bold_price",
      "label": "Preis fett",
      "default": true
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Spalten (Desktop)"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Abstand oben",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Abstand unten",
      "default": 60
    }
  ],
  "blocks": [
    {
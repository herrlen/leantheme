{%- comment -%}
  Breadcrumbs - Visual Navigation
  Supports: Product, Collection, Article, Blog, Page, Search
  Called via breadcrumbs-wrapper.liquid (not directly)
{%- endcomment -%}

{%- liquid
  assign separator = settings.breadcrumbs_separator | default: '›'
  assign use_home_icon = settings.breadcrumbs_home_icon
  assign home_text = settings.breadcrumbs_home_text
  if home_text == blank
    assign home_text = 'general.breadcrumbs.home' | t
  endif
-%}

<nav class="breadcrumbs" aria-label="{{ 'general.breadcrumbs.aria_label' | t | default: 'Breadcrumb' }}">
  <ol class="breadcrumbs__list">

    {%- comment -%} Home {%- endcomment -%}
    <li class="breadcrumbs__item">
      <a class="breadcrumbs__link" href="{{ routes.root_url }}">
        {%- if use_home_icon -%}
          <svg class="breadcrumbs__home-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <span class="visually-hidden">{{ home_text }}</span>
        {%- else -%}
          {{- home_text -}}
        {%- endif -%}
      </a>
    </li>

    {%- comment -%} Product: Home → Collection → Product {%- endcomment -%}
    {%- if request.page_type == 'product' -%}
      {%- if collection -%}
        <li class="breadcrumbs__item">
          <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
          <a class="breadcrumbs__link" href="{{ collection.url }}">{{ collection.title }}</a>
        </li>
      {%- elsif product.collections.size > 0 -%}
        <li class="breadcrumbs__item">
          <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
          <a class="breadcrumbs__link" href="{{ product.collections.first.url }}">{{ product.collections.first.title }}</a>
        </li>
      {%- endif -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ product.title }}</span>
      </li>

    {%- comment -%} Collection: Home → (Parent) → Collection {%- endcomment -%}
    {%- elsif request.page_type == 'collection' -%}
      {%- if collection.metafields.custom.parent_collection != blank -%}
        {%- assign parent = collection.metafields.custom.parent_collection.value -%}
        <li class="breadcrumbs__item">
          <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
          <a class="breadcrumbs__link" href="{{ parent.url }}">{{ parent.title }}</a>
        </li>
      {%- endif -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ collection.title }}</span>
      </li>

    {%- comment -%} Blog: Home → Blog {%- endcomment -%}
    {%- elsif request.page_type == 'blog' -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ blog.title }}</span>
      </li>

    {%- comment -%} Article: Home → Blog → Article {%- endcomment -%}
    {%- elsif request.page_type == 'article' -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <a class="breadcrumbs__link" href="{{ blog.url }}">{{ blog.title }}</a>
      </li>
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ article.title }}</span>
      </li>

    {%- comment -%} Page: Home → Page {%- endcomment -%}
    {%- elsif request.page_type == 'page' -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ page.title }}</span>
      </li>

    {%- comment -%} Search: Home → Search {%- endcomment -%}
    {%- elsif request.page_type == 'search' -%}
      <li class="breadcrumbs__item">
        <span class="breadcrumbs__separator" aria-hidden="true">{{ separator }}</span>
        <span class="breadcrumbs__current" aria-current="page">{{ 'general.breadcrumbs.search' | t | default: 'Search' }}</span>
      </li>

    {%- endif -%}

  </ol>
</nav>

<style>
  .breadcrumbs {
    font-size: var(--breadcrumb-font-size, 0.8rem);
    color: var(--color-text-secondary, #666);
    margin-bottom: 16px;
    overflow: hidden;
  }
  .breadcrumbs__list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .breadcrumbs__list::-webkit-scrollbar { display: none; }
  .breadcrumbs__item {
    display: inline-flex;
    align-items: center;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .breadcrumbs__item:last-child { flex-shrink: 1; min-width: 0; }
  .breadcrumbs__link {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s;
    display: inline-flex;
    align-items: center;
  }
  .breadcrumbs__link:hover {
    color: var(--color-text, #000);
    text-decoration: underline;
  }
  .breadcrumbs__home-icon { flex-shrink: 0; }
  .breadcrumbs__separator {
    margin: 0 6px;
    opacity: 0.5;
    flex-shrink: 0;
    font-size: 0.75em;
  }
  .breadcrumbs__current {
    color: var(--color-text, #000);
    font-weight: 500;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 250px;
  }
  @media (max-width: 749px) {
    .breadcrumbs__current { max-width: 150px; }
    .breadcrumbs { font-size: 0.75rem; }
  }
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>
